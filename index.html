<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body class="marginAuto">
    <main class="widthmax heightmax fx fxColumn jsContentSB">
        <div id="divChampsPerso" class="fx jsContentSB"> <!-- champs Present Perosnnage -->
            <div class="champsDiv scaleX fx"> <!-- presente perso Left -->
                <div id="imgPersoL"></div>
                <div class="scaleX fx fxWrap widthmax"> <!-- div caracteristique -->
                    <div id="caractLifeL" class="caractPolice fx jsContentC alItemsC"></div>
                    <div id="caractManaL" class="caractPolice fx jsContentC alItemsC"></div>
                    <div id="caractPowerL" class="caractPolice fx jsContentC alItemsC"></div>
                    <div id="caractArmureL" class="caractPolice fx jsContentC alItemsC"></div>
                </div>
            </div>
            <div class="champsDiv fx"> <!-- presente perso Right -->
                <div id="imgPersoR"></div>
                <div class="fx fxWrap widthmax">
                    <div id="caractLifeR" class="caractPolice fx jsContentC alItemsC"></div>
                    <div id="caractManaR" class="caractPolice fx jsContentC alItemsC"></div>
                    <div id="caractPowerR" class="caractPolice fx jsContentC alItemsC"></div>
                    <div id="caractArmureR" class="caractPolice fx jsContentC alItemsC"></div>
                </div>
            </div>
        </div>
        <div class="fx widthmax jsContentSA"> <!-- Barre de vie HP x2 -->
                <div id="" class="hpdiv lifePencherL"> <!-- Barre de vie n°1 -->
                    <div id="inHpL" class="inHp heightmax"></div> <!-- Barre verte -->
                    <div class="fx jsContentSB"> <!-- Nom et mana -->
                        <p id="namePlayerL" class="policeName marginone scaleX">POMME</p>
                        <div class="manaDiv scaleX">
                            <div id="manaLeft" class="heightmax widthmin"></div>
                        </div>
                    </div>
                </div>
                <div id="" class="hpdiv lifePencherR"> <!-- Barre de vie n°2 -->
                    <div id ="inHpR" class="inHp heightmax"></div> <!-- Barre verte -->
                    <div class="fx jsContentSB"> <!-- Nom et mana -->
                        <p id="namePlayerR" class="policeName marginone">POIRE</p>
                        <div class="manaDiv scaleX">
                            <div id="manaRight" class="heightmax widthmin"></div>
                        </div>
                    </div>
                </div>
        </div>
        <div id="champlayer" class="fx"> <!-- Champs Players -->
            <div id="playerOne" class=""></div>
            <div id="playerTwo" class=""></div>
        </div>
    </main>
    <script>

        let ninjagirl = document.body.querySelector(".ninjagirl");
        let ninjaboy = document.body.querySelector(".ninjaboy");

        let playerOne = document.querySelector("#playerOne");
        let playerTwo = document.querySelector("#playerTwo");
        
        let data = [];

        let perso1 = new Object();
        perso1.life = 100;
        perso1.power = 20;
        perso1.armure = 1;
        perso1.mana = 0;

        let perso2 = new Object();
        perso2.life = 100;
        perso2.power = 17;
        perso2.armure = 3;
        perso2.mana = 0;
        perso2.name = "Claudia";
        perso2.chemin = playerTwo;
        perso2.stop = "ninjaboy"; // class
        perso2.attack = "ninjaboyattack";
        perso2.run = "ninjaboyrun";

        let perso3 = new Object();
        perso3.life = 100;
        perso3.power = 13;
        perso3.armure = 5;
        perso3.mana = 0;

        let perso4 = new Object();
        perso4.life = 100;
        perso4.power = 10;
        perso4.armure = 8;
        perso4.mana = 0;
        perso4.name = "Titania";
        perso4.chemin = playerOne;
        perso4.stop = "ninjagirl"; // class
        perso4.attack = "ninjagirlattack";
        perso4.run = "ninjagirlrun";

        data.push(perso1); // data[0]
        data.push(perso2); // data[1]
        data.push(perso3); // data[2]
        data.push(perso4); // data[3]


        joueur1 = data[3];
        joueur2 = data[1];

        playerOne.classList = joueur1.stop;
        playerTwo.classList = joueur2.stop + " scaleX";
                
        document.querySelector("#namePlayerL").textContent = joueur1.name;
        document.querySelector("#namePlayerR").textContent = joueur2.name;


        function coufaible(attacker, victim){
            let damageLife = attacker.power - victim.armure;
            victim.life -= damageLife;
            attacker.mana += attacker.power;
        }
        function potion(perso){
            if(perso.life === 100 && perso.power > perso.mana){
                let reste = 100 - perso.life;
                return perso.mana - perso.life;
            }
            if(perso.mana !== 0){ // augmenter life
                perso.life += perso.power;
            }
            if(perso.life <= 100 && perso.mana !== 0){ // diminuer mana
                perso.mana -= perso.power;
            }
        }
        function hpMoove(id, playerlife){ 
            if(playerlife.life < 0){
                document.querySelector(id).style.width = 0 + "%";
                playerlife.life = 0;
            } else if(playerlife.life > 100){
                document.querySelector(id).style.width = 100 + "%";
                playerlife.life = 100;
            }
            else{
                document.querySelector(id).style.width = playerlife.life + "%";
            }
        }
        function manaMoove(id, playerlife){ 
            if(playerlife.mana <= 0){
                document.querySelector(id).style.width = 0 + "%";
                playerlife.mana = 0;
            } else if(playerlife.mana >= 100){
                document.querySelector(id).style.width = 100 + "%";
                playerlife.mana = 100;
            }
            else{
                document.querySelector(id).style.width = playerlife.mana + "%";
            }
        }
        function animend(cheminClass, oldclass, newclass) {
            document.body.querySelector(cheminClass).addEventListener("animationend", function(){
                oldclass.classList = newclass;
            });
        }
        function textIn(chemin, commentaire, keys){
            document.querySelector(chemin).textContent = commentaire + keys;

        }


            let player1Moove = 25; // indice pour marginleft placement joueur
            let player2Moove = 75;

        document.addEventListener("keydown", function(e){
            let entre = e.keyCode;
            //console.log("left : " + document.getElementById("playerOne").offsetLeft + "  right : " + document.getElementById("playerOne").offsetTop);

            switch(entre){
                case 39 : // fleche droite
                    if(player1Moove < 100){
                        player1Moove += 1; 
                        playerOne.style.left = player1Moove + "%";
                    }
                    joueur1.chemin.classList = joueur1.run;
                    animend("." + joueur1.run, joueur1.chemin, joueur1.stop);
                break;
                case 37 : // fleche gauche
                    if(player1Moove > 0){
                        player1Moove -= 1; 
                        playerOne.style.left = player1Moove + "%";
                    }
                    joueur1.chemin.classList = joueur1.run + " scaleX";
                    animend("." + joueur1.run, joueur1.chemin, joueur1.stop + " scaleX");
                break;
                case 88 : // fleche player 2 droite
                    if(player2Moove < 100){
                        player2Moove += 1; 
                        playerTwo.style.left = player2Moove + "%";
                    }
                    joueur2.chemin.classList = joueur2.run;
                    animend("." + joueur2.run, joueur2.chemin, joueur2.stop);
                break;
                case 87 : // fleche player 2 gauche
                    if(player2Moove > 0){
                        player2Moove -= 1; 
                        playerTwo.style.left = player2Moove + "%";
                    }
                    joueur2.chemin.classList = joueur2.run + " scaleX";
                    animend("." + joueur2.run, joueur2.chemin, joueur2.stop + " scaleX");
                break;
                case 69 : // e potion player1
                    potion(joueur1);
                    hpMoove("#inHpL", joueur1);
                    manaMoove("#manaLeft", joueur1);
                    textIn("#caractManaL", "Mana : ", joueur1.mana);
                break;
                case 80 : // p potion player2
                    potion(joueur2);
                    hpMoove("#inHpR", joueur2);
                    manaMoove("#manaRight", joueur2);
                    textIn("#caractManaR", "Mana : ", joueur2.mana);
                break;
                case 65 : // only animation attack player 1
                    if(joueur1.stop !== playerOne.className){ // condition pour profile du player lors de l'attaque
                        joueur1.chemin.classList = joueur1.attack + " scaleX";
                        animend("." + joueur1.attack, joueur1.chemin, joueur1.stop + " scaleX");
                    } else {
                        joueur1.chemin.classList = joueur1.attack;
                        animend("." + joueur1.attack, joueur1.chemin, joueur1.stop);
                    }
                break;
                case 73 : // only animation attack player 2
                    if(joueur2.stop !== playerTwo.className){
                        joueur2.chemin.classList = joueur2.attack + " scaleX";
                        animend("." + joueur2.attack, joueur2.chemin, joueur2.stop + " scaleX");
                    } else {
                        joueur2.chemin.classList = joueur2.attack;
                        animend("." + joueur2.attack, joueur2.chemin, joueur2.stop);
                    }
            }
            let mooveResult = player2Moove - player1Moove;
            if(mooveResult < 10 && mooveResult > -10){
                switch(entre){
                    case 65 : // a attack player1
                        coufaible(joueur1, joueur2); // attacker , victim
                        hpMoove("#inHpR", joueur2);  // victim
                        manaMoove("#manaLeft", joueur1);
                    break;

                    case 73 : // i attack player2
                        coufaible(joueur2, joueur1);
                        hpMoove("#inHpL", joueur1);
                        manaMoove("#manaRight", joueur2);
                    break;
                    default:
                        return null;
                    break;
                }
                textIn("#caractLifeL", "Life : ", joueur1.life);
                textIn("#caractLifeR", "Life : ", joueur2.life);
                textIn("#caractManaL", "Mana : ", joueur1.mana);
                textIn("#caractManaR", "Mana : ", joueur2.mana);
                textIn("#caractPowerL", "Power : ", joueur1.power);
                textIn("#caractPowerR", "Power : ", joueur2.power);
                textIn("#caractArmureL", "Armor : ", joueur1.armure);
                textIn("#caractArmureR", "Armor : ", joueur2.armure);
            
            console.log(player1Moove);
            console.log(player2Moove);
        }
        });
        

    </script>
</body>
</html>